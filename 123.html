<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å°èªªæ›¸åŸ - å°ˆæ¥­é–±è®€ç‰ˆ</title>
<style>
:root{--bg:#f4f4f4;--card:#fff;--text:#111;--muted:#666;--border:#ddd;--accent:#4f46e5}
body.dark{--bg:#0f1220;--card:#151936;--text:#e8e9ff;--muted:#b6b8ff;--border:#2a2f6b;--accent:#8b8cff}
body.green{--bg:#eef7f1;--card:#f7fff9;--text:#103b2a;--muted:#3a6b57;--border:#cce3d6;--accent:#2f855a}
body{background:var(--bg);color:var(--text);font-family: Arial, "Microsoft JhengHei", sans-serif;padding:20px;transition:.2s;line-height:1.6}
.container{max-width:900px;margin:auto}
.toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom: 20px;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;margin-top:16px}
.card{background:var(--card);border-radius:12px;padding:16px;border:1px solid var(--border);transition:.2s;position: relative;}
.card:hover{transform:translateY(-4px);box-shadow: 0 4px 12px rgba(0,0,0,0.1)}
.card h3{margin:0;display: flex; align-items: center; justify-content: space-between;}
.card h3 .title-text {cursor:pointer; flex-grow: 1;}
.card small{color:var(--muted)}
.chapter{cursor:pointer;color:var(--accent);margin:8px 0; padding: 8px; border-bottom: 1px dashed var(--border)}
.chapter:hover{background: rgba(0,0,0,0.05)}
button{border-radius:6px;border:1px solid var(--border);padding:6px 12px;background:var(--card);color:var(--text);cursor:pointer; font-size: 14px;}
button.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
input,textarea{width:100%;margin:6px 0;padding:10px;border-radius:6px;border:1px solid var(--border);background:var(--card);color:var(--text);box-sizing: border-box;}
textarea{height:150px; resize: vertical;}
.viewer{margin-top:15px; padding: 15px; background: rgba(0,0,0,0.03); border-radius: 8px;}
.viewer h4 {margin-top: 0;}
.viewer p {white-space: pre-wrap; word-wrap: break-word;}

/* é–±è®€æ¨¡å¼é™åˆ¶ */
body.reading-mode .toolbar, 
body.reading-mode h2, 
body.reading-mode .add-section, 
body.reading-mode .card-controls,
body.reading-mode .chapter-input-area,
body.reading-mode .card:not(.active-card) {display:none !important}

body.reading-mode .container {max-width: 800px;}
body.reading-mode .card.active-card {border: none; background: transparent;}
.exit-reading {display: none; position: fixed; top: 20px; right: 20px; z-index: 100;}
body.reading-mode .exit-reading {display: block;}

.like{cursor:pointer;font-size:20px; transition: 0.2s;}
.like.on{color:#f43f5e}
.modeBtns button{margin-left:6px; font-size: 18px;}
.edit-btn {font-size: 12px; opacity: 0.6; cursor: pointer; margin-right: 8px;}
.edit-btn:hover {opacity: 1;}
</style>
</head>
<body>
<p>hello~æ­¡è¿ä¾†åˆ°Daydreamå°èªªæ›¸åŸ</p>
<div class="container">
  <button class="exit-reading" onclick="toggleReading()">é€€å‡ºé–±è®€ ğŸ“–</button>
  
  <div class="toolbar">
    <h1>ğŸ“š å°èªªæ›¸åŸ</h1>
    <div class="modeBtns">
      <button onclick="toggleDark()" title="å¤œé–“æ¨¡å¼">ğŸŒ™</button>
      <button onclick="toggleGreen()" title="è­·çœ¼æ¨¡å¼">ğŸŸ¢</button>
      <button onclick="toggleReading()" title="é–±è®€æ¨¡å¼">ğŸ“–</button>
    </div>
  </div>

  <div class="add-section">
    <h2>â• æ–°å¢å°èªª</h2>
    <div style="display: flex; gap: 8px;">
        <input id="novelTitle" placeholder="è«‹è¼¸å…¥å°èªªåç¨±..." />
        <button class="primary" onclick="addNovel()" style="white-space: nowrap;">æ–°å¢</button>
    </div>
  </div>

  <div class="grid" id="bookGrid"></div>
</div>

<script>
let novels = JSON.parse(localStorage.getItem('novels')) || [];
let openIndex = null;

const save = () => localStorage.setItem('novels', JSON.stringify(novels));
const cn = n => ['é›¶','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹','å'][n+1] || (n+1);
const chapterName = i => `ç¬¬ ${cn(i)} ç« `;

// åˆå§‹åŒ–ä¸»é¡Œ
if(localStorage.getItem('mode')==='dark') document.body.classList.add('dark');
if(localStorage.getItem('mode')==='green') document.body.classList.add('green');

function toggleDark(){
    document.body.classList.toggle('dark');
    document.body.classList.remove('green');
    localStorage.setItem('mode', document.body.classList.contains('dark') ? 'dark' : 'light');
}

function toggleGreen(){
    document.body.classList.toggle('green');
    document.body.classList.remove('dark');
    localStorage.setItem('mode', document.body.classList.contains('green') ? 'green' : 'light');
}

function toggleReading(){
    if(openIndex === null) {
        alert('è«‹å…ˆå±•é–‹ä¸€æœ¬å°èªªå†é€²å…¥é–±è®€æ¨¡å¼');
        return;
    }
    document.body.classList.toggle('reading-mode');
}

function addNovel(){
    const t = document.getElementById('novelTitle').value.trim();
    if(!t) return alert('è«‹è¼¸å…¥åç¨±');
    novels.push({title:t, liked:false, chapters:[]});
    document.getElementById('novelTitle').value = '';
    save();
    render();
}

function editNovel(i){
    const newTitle = prompt('è«‹è¼¸å…¥æ–°çš„å°èªªåç¨±', novels[i].title);
    if(newTitle === null) return;
    if(!newTitle.trim()) return alert('åç¨±ä¸èƒ½ç‚ºç©º');
    novels[i].title = newTitle.trim();
    save();
    render();
}

function toggleOpen(i){
    openIndex = (openIndex === i) ? null : i;
    render();
}

function render(){
    const grid = document.getElementById('bookGrid');
    grid.innerHTML = '';
    novels.forEach((n, i) => {
        const card = document.createElement('div');
        card.className = `card ${openIndex === i ? 'active-card' : ''}`;
        
        const isLiked = n.liked ? 'on' : '';
        
        card.innerHTML = `
            <h3>
                <span class="title-text" onclick="toggleOpen(${i})">
                    ${n.title}
                </span>
                <span class="card-controls">
                    <span class="edit-btn" onclick="editNovel(${i})">âœï¸</span>
                    <span class="like ${isLiked}" onclick="toggleLike(event, ${i})">â¤</span>
                </span>
            </h3>
            <small>${n.chapters.length} ç« ç¯€</small>
            <div class="content" id="content-${i}"></div>
        `;
        
        grid.appendChild(card);
        if(openIndex === i) renderChapters(document.getElementById(`content-${i}`), i);
    });
}

function toggleLike(e, i) {
    e.stopPropagation();
    novels[i].liked = !novels[i].liked;
    save();
    render();
}

function renderChapters(container, i){
    const n = novels[i];
    let html = `<hr><div class="chapter-input-area">
        <input placeholder="ç« ç¯€æ¨™é¡Œï¼ˆå¯é¸ï¼‰" id="ct${i}">
        <textarea placeholder="è«‹åœ¨æ­¤è™•è¼¸å…¥ç« ç¯€å…§å®¹..." id="cc${i}"></textarea>
        <button class="primary" onclick="addChapter(${i})">ç™¼ä½ˆç« ç¯€</button>
    </div><div id="chapter-list-${i}">`;
    
    container.innerHTML = html;
    
    const listDiv = document.getElementById(`chapter-list-${i}`);
    n.chapters.forEach((c, idx) => {
        const d = document.createElement('div');
        d.className = 'chapter';
        d.textContent = c.title ? `${chapterName(idx)}ï¼š${c.title}` : chapterName(idx);
        d.onclick = () => viewChapter(container, i, idx);
        listDiv.appendChild(d);
    });
}

function addChapter(i){
    const t = document.getElementById('ct'+i).value.trim();
    const c = document.getElementById('cc'+i).value.trim();
    if(!c) return alert('ç« ç¯€å…§å®¹ä¸èƒ½ç‚ºç©º');
    
    novels[i].chapters.push({
        title: t,
        content: c,
        time: new Date().toLocaleString()
    });
    save();
    render();
}

function viewChapter(container, i, idx){
    const c = novels[i].chapters[idx];
    // ç§»é™¤èˆŠçš„é–±è®€å™¨
    const oldViewer = container.querySelector('.viewer');
    if(oldViewer) oldViewer.remove();
    
    const v = document.createElement('div');
    v.className = 'viewer';
    const displayTitle = c.title ? `${chapterName(idx)}ï¼š${c.title}` : chapterName(idx);
    
    v.innerHTML = `
        <h4>${displayTitle}</h4>
        <small style="color:var(--muted)">ç™¼ä½ˆæ™‚é–“ï¼š${c.time}</small>
        <p>${c.content}</p>
        <div class="card-controls" style="margin-top:20px; display:flex; gap:10px;">
            <button onclick="editChapter(${i}, ${idx})">âœï¸ ç·¨è¼¯å…§å®¹</button>
            <button onclick="deleteChapter(${i}, ${idx})" style="color:red">ğŸ—‘ï¸ åˆªé™¤ç« ç¯€</button>
        </div>
    `;
    container.appendChild(v);
    v.scrollIntoView({behavior: 'smooth'});
}

function editChapter(i, idx){
    const c = novels[i].chapters[idx];
    const newContent = prompt('ç·¨è¼¯ç« ç¯€å…§å®¹ï¼š', c.content);
    if(newContent === null) return;
    
    novels[i].chapters[idx].content = newContent;
    novels[i].chapters[idx].time = new Date().toLocaleString() + " (å·²ç·¨è¼¯)";
    save();
    render();
}

function deleteChapter(i, idx){
    if(!confirm('ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤æ­¤ç« ç¯€å—ï¼Ÿ')) return;
    novels[i].chapters.splice(idx, 1);
    save();
    render();
}

// åˆå§‹æ¸²æŸ“
render();
</script>

</body>
</html>