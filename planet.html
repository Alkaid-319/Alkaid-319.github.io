<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å°èªªæŠ•ç¨¿ç¶²ç«™ï¼ˆç« ç¯€æ’åºï¼‹å¤œé–“æ¨¡å¼ï¼‰</title>
  <style>
    :root {
      --bg: #f4f4f4;
      --card: #ffffff;
      --text: #111;
      --muted: #666;
      --border: #ddd;
      --accent: #4f46e5;
    }
    body.dark {
      --bg: #0f1220;
      --card: #151936;
      --text: #e8e9ff;
      --muted: #b6b8ff;
      --border: #2a2f6b;
      --accent: #8b8cff;
    }
    body {
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 20px;
      transition: background .2s, color .2s;
    }
    .container { max-width: 960px; margin: auto; background: var(--card); padding: 20px; border-radius: 10px; }
    h1, h2, h3 { margin-top: 0; }
    input, textarea {
      width: 100%; padding: 8px; margin: 6px 0; color: var(--text);
      background: transparent; border: 1px solid var(--border); border-radius: 6px;
    }
    textarea { height: 140px; }
    button {
      padding: 6px 12px; margin-right: 6px; cursor: pointer; border-radius: 6px;
      border: 1px solid var(--border); background: transparent; color: var(--text);
    }
    button.primary { background: var(--accent); color: #fff; border-color: var(--accent); }
    .row { display: flex; gap: 8px; align-items: center; }
    .list-item { padding: 8px; border-bottom: 1px solid var(--border); cursor: pointer; }
    .list-item:hover { background: rgba(0,0,0,.04); }
    body.dark .list-item:hover { background: rgba(255,255,255,.06); }
    .chapter { padding-left: 16px; color: var(--muted); cursor: pointer; }
    .chapter:hover { text-decoration: underline; }
    .toolbar { display: flex; justify-content: space-between; align-items: center; }
    .spacer { height: 12px; }
    small { color: var(--muted); }
  </style>
</head>
<body>
hello~æ­¡è¿ä¾†åˆ°é€™å€‹å°èªªç¶²ç«™
<div class="container">
  <div class="toolbar">
    <h1>å°èªªæŠ•ç¨¿ç¶²ç«™</h1>
    <button onclick="toggleDark()">ğŸŒ™ å¤œé–“æ¨¡å¼</button>
  </div>

  <h2>æ–°å¢å°èªª</h2>
  <div class="row">
    <input id="novelTitle" placeholder="å°èªªåç¨±" />
    <button class="primary" onclick="addNovel()">æ–°å¢</button>
  </div>

  <h2>å°èªªåˆ—è¡¨</h2>
  <div id="novelList"></div>

  <div class="spacer"></div>
  <hr />

  <div id="chapterArea" style="display:none">
    <h2 id="currentNovel"></h2>

    <input id="chapterTitle" placeholder="ç« ç¯€æ¨™é¡Œï¼ˆå¯ç•™ç©ºï¼Œå°‡è‡ªå‹•ç·¨è™Ÿï¼‰" />
    <textarea id="chapterContent" placeholder="ç« ç¯€å…§å®¹"></textarea>

    <button class="primary" onclick="addChapter()">æ–°å¢/æ›´æ–°ç« ç¯€</button>
    <button onclick="cancelEdit()" id="cancelBtn" style="display:none">å–æ¶ˆç·¨è¼¯</button>

    <h3>ç« ç¯€åˆ—è¡¨</h3>
    <div id="chapterList"></div>

    <div id="viewer"></div>
  </div>
</div>

<script>
  // ====== State ======
  let novels = JSON.parse(localStorage.getItem('novels')) || [];
  let currentNovelIndex = null;
  let editChapterIndex = null;

  // ====== Utils ======
  function save() { localStorage.setItem('novels', JSON.stringify(novels)); }
  function cnNum(n){ const map=['é›¶','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹','å']; if(n<=10) return map[n]; if(n<20) return 'å'+map[n-10]; return map[Math.floor(n/10)]+'å'+(n%10?map[n%10]:''); }
  function chapterName(i, custom){ return custom && custom.trim()? custom : `ç¬¬${cnNum(i+1)}ç« `; }

  // ====== Dark Mode ======
  function applyDark(){ const d = localStorage.getItem('dark')==='1'; document.body.classList.toggle('dark', d); }
  function toggleDark(){ const d = document.body.classList.toggle('dark'); localStorage.setItem('dark', d?'1':'0'); }
  applyDark();

  // ====== Novels ======
  function addNovel(){
    const title = novelTitle.value.trim(); if(!title) return alert('è«‹è¼¸å…¥å°èªªåç¨±');
    novels.push({ title, chapters: [] }); novelTitle.value=''; save(); renderNovels();
  }
  function renderNovels(){
    const list = novelList; list.innerHTML='';
    novels.forEach((n,i)=>{ const d=document.createElement('div'); d.className='list-item'; d.textContent=n.title; d.onclick=()=>openNovel(i); list.appendChild(d); });
  }
  function openNovel(i){ currentNovelIndex=i; chapterArea.style.display='block'; currentNovel.innerText=novels[i].title; renderChapters(); viewer.innerHTML=''; }

  // ====== Chapters ======
  function addChapter(){
    const t = chapterTitle.value.trim(); const c = chapterContent.value.trim(); if(!c) return alert('è«‹å¡«å¯«å…§å®¹');
    const novel = novels[currentNovelIndex];
    if(editChapterIndex===null){ novel.chapters.push({ title:t, content:c, time:new Date().toLocaleString() }); }
    else { Object.assign(novel.chapters[editChapterIndex], { title:t, content:c }); editChapterIndex=null; cancelBtn.style.display='none'; }
    chapterTitle.value=''; chapterContent.value=''; save(); renderChapters();
  }
  function renderChapters(){
    const list = chapterList; list.innerHTML='';
    const ch = novels[currentNovelIndex].chapters;
    ch.forEach((c,i)=>{ const d=document.createElement('div'); d.className='chapter'; d.textContent=chapterName(i, c.title); d.onclick=()=>viewChapter(i); list.appendChild(d); });
  }
  function viewChapter(i){
    const c = novels[currentNovelIndex].chapters[i];
    viewer.innerHTML = `<h3>${chapterName(i,c.title)}</h3><small>${c.time}</small><p>${c.content.replace(/\n/g,'<br>')}</p><button onclick="editChapter(${i})">ç·¨è¼¯</button><button onclick="deleteChapter(${i})">åˆªé™¤</button>`;
  }
  function editChapter(i){ const c=novels[currentNovelIndex].chapters[i]; chapterTitle.value=c.title||''; chapterContent.value=c.content; editChapterIndex=i; cancelBtn.style.display='inline-block'; window.scrollTo({top:0,behavior:'smooth'}); }
  function cancelEdit(){ editChapterIndex=null; chapterTitle.value=''; chapterContent.value=''; cancelBtn.style.display='none'; }
  function deleteChapter(i){ if(!confirm('ç¢ºå®šåˆªé™¤ç« ç¯€ï¼Ÿ')) return; novels[currentNovelIndex].chapters.splice(i,1); save(); viewer.innerHTML=''; renderChapters(); }

  renderNovels();
</script>

</body>
</html>
